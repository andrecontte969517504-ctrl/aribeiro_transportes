<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mapa da Rota</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css" />
<style>
  body { margin:0; font-family: Arial, sans-serif; }
  #map { width:100%; height:100vh; }
  .info { position:absolute; top:10px; left:10px; background:white; padding:10px; border-radius:6px; box-shadow:0 2px 6px rgba(0,0,0,0.2); z-index:1000; max-width:300px; }
</style>
</head>
<body>

<div id="map"></div>
<div class="info" id="infoRota">Carregando rota...</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>
<script>
window.onload = function() {
  const infoDiv = document.getElementById('infoRota');
  const rotaStr = localStorage.getItem('rota');
  
  if(!rotaStr) {
    infoDiv.innerHTML = "‚ùå Nenhuma rota encontrada. Volte para inserir origem e destino.";
    return;
  }
  
  const rota = JSON.parse(rotaStr);
  const origem = rota.origem;
  const destino = rota.destino;
  
  // Cria mapa centralizado na origem
  const map = L.map('map').setView([origem.lat, origem.lng], 15);
  
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '¬© OpenStreetMap'
  }).addTo(map);
  
  // Marcadores
  L.marker([origem.lat, origem.lng]).addTo(map).bindPopup("üìç Origem").openPopup();
  L.marker([destino.lat, destino.lng]).addTo(map).bindPopup("üéØ Destino");
  
  // Rota detalhada rua a rua
  L.Routing.control({
    waypoints: [
      L.latLng(origem.lat, origem.lng),
      L.latLng(destino.lat, destino.lng)
    ],
    routeWhileDragging: false,
    showAlternatives: false,
    lineOptions: { styles: [{color:'#007bff', opacity:0.8, weight:6}] },
    router: L.Routing.osrmv1({ serviceUrl: 'https://router.project-osrm.org/route/v1' }),
    createMarker: function(i, wp) { return L.marker(wp.latLng); }
  }).on('routesfound', function(e) {
    const route = e.routes[0];
    const distanciaKm = (route.summary.totalDistance/1000).toFixed(2);
    const tempoMin = Math.ceil(route.summary.totalTime/60);
    infoDiv.innerHTML = `üìè Dist√¢ncia: <strong>${distanciaKm} km</strong> | ‚è±Ô∏è Tempo estimado: <strong>${tempoMin} min</strong>`;
  }).addTo(map);
};
</script>
</body>
</html>
